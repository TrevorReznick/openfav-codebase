---
import Head from '@/components/head/OpenFavHead.astro'
import Layout from '@/layouts/Layout.astro';

// Import the config to test if it's working
import { SITE, I18N, METADATA, UI, ANALYTICS } from 'openfav:config';

// Log the config to console for debugging
console.log({ SITE, I18N, METADATA, UI, ANALYTICS });

// Log the current page (server-side)
console.log(`[page][${Astro.url.pathname}]`);

// Get the theme from cookies or default to system
let theme = 'system';
if (Astro.cookies.has('theme')) {
  theme = Astro.cookies.get('theme').value;
}

// Add theme class to HTML element (server-side)
const htmlClass = theme === 'dark' ? 'dark' : theme === 'light' ? 'light' : '';
---

<Layout>
  <Head />
  
  <main class="min-h-screen bg-background text-foreground transition-colors" data-theme={theme} class:list={[htmlClass]}>
    <div class="absolute inset-0 -z-10 bg-background"></div>
    <div class="container mx-auto px-4 py-8">
      <h1 class="text-4xl font-bold mb-6">Welcome to OpenFav Test Site</h1>
      
      <section class="mb-8 p-6 rounded-lg bg-card text-card-foreground shadow">
        <h2 class="text-2xl font-semibold mb-4 text-primary">About This Page</h2>
        <p class="mb-4 text-muted-foreground">
          This is a test page to verify OpenFav integration with Astro. The page includes SEO meta tags,
          OpenGraph tags, and other metadata configured through the OpenFav integration.
        </p>
        <p class="text-muted-foreground">
          Check the page source to see the generated meta tags in the &lt;head&gt; section.
        </p>
      </section>

    <section class="grid md:grid-cols-2 gap-6 mb-8">
      <div class="bg-card p-6 rounded-lg border border-border shadow-sm">
        <h3 class="text-xl font-semibold mb-3 text-primary">Features</h3>
        <ul class="list-disc pl-5 space-y-2 text-muted-foreground">
          <li>SEO Optimization</li>
          <li>OpenGraph Support</li>
          <li>Twitter Card Support</li>
          <li>i18n Ready</li>
          <li>Analytics Integration</li>
        </ul>
      </div>
      
      <div class="bg-card p-6 rounded-lg border border-border shadow-sm">
        <h3 class="text-xl font-semibold mb-3 text-primary">Configuration</h3>
        <div class="space-y-2 text-muted-foreground">
          <div><span class="font-medium text-foreground">Site Name:</span> {SITE.name}</div>
          <div><span class="font-medium text-foreground">Description:</span> {SITE.description}</div>
          <div><span class="font-medium text-foreground">Base URL:</span> {SITE.url}</div>
          <div><span class="font-medium text-foreground">Locale:</span> {I18N.defaultLocale}</div>
        </div>
      </div>
    </section>

    <section class="bg-accent/30 p-6 rounded-lg mb-8 border border-border shadow-sm">
      <h2 class="text-2xl font-semibold mb-4 text-primary">Get Started</h2>
      <p class="mb-4 text-muted-foreground">
        To customize this page, edit the <code class="bg-muted px-1 rounded text-sm">src/pages/index.astro</code> file.
        The OpenFav configuration can be found in the <code class="bg-muted px-1 rounded text-sm">openfav.config.ts</code> file.
      </p>
      <div class="flex flex-wrap gap-4">
        <a href="/build/hello" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
          Go to Hello Page
        </a>
        <a href="/build/welcome" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
          Go to Welcome Page
        </a>
      </div>
    </section>
  </main>
  <script is:inline>
    // Initialize theme on page load
    document.addEventListener('DOMContentLoaded', () => {
      // Get the current theme from localStorage or fallback to system
      const getCurrentTheme = () => {
        try {
          return localStorage.getItem('theme') || 'system';
        } catch (e) {
          console.warn('Could not access localStorage:', e);
          return 'system';
        }
      };

      // Apply theme to the page
      const applyTheme = (theme) => {
        const html = document.documentElement;
        const isSystem = theme === 'system';
        const resolvedTheme = isSystem 
          ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
          : theme;
        
        // Update classes and attributes
        html.classList.remove('light', 'dark');
        html.classList.add(resolvedTheme);
        html.setAttribute('data-theme', theme);
        
        // Update the main element
        const main = document.querySelector('main');
        if (main) {
          main.classList.remove('light', 'dark');
          main.classList.add(resolvedTheme);
          main.setAttribute('data-theme', theme);
        }
      };

      // Apply initial theme
      const initialTheme = getCurrentTheme();
      applyTheme(initialTheme);

      // Listen for theme changes
      window.addEventListener('storage', (e) => {
        if (e.key === 'theme') {
          applyTheme(e.newValue || 'system');
        }
      });

      // Listen for system theme changes
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (getCurrentTheme() === 'system') {
          applyTheme('system');
        }
      });
    });
  </script>
</Layout>
